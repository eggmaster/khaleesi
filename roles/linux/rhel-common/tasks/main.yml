---
#RHEL

- name: Ensure redhat-release-server
  yum: name=redhat-release-server state=present

- name: Remove all yum repositories
  file: path=/etc/yum.repos.d/*.repo state=absent

- name: Create the RHEL Repositories
  template: src=rhel.repo.j2 dest=/etc/yum.repos.d/rhel.repo

- name: Create the EPEL Repository
  template: src=epel.repo.j2 dest=/etc/yum.repos.d/epel.repo

- name: Yum clean all
  command: yum clean all

- name: Ensure httplib2
  yum: name=python-httplib2 state=present

- name: be sure openssl-devel is installed
  yum: name=openssl-devel state=installed
  tags: openssl-devel

#WORKAROUND
- name: Ensure /etc/sysconfig/iptables-services
  copy: src=iptables dest=/etc/sysconfig/iptables owner=root group=root mode=0600 force=no

- name: Ensure iptables
  yum: name=iptables state=present

- name: yum -y update to latest packages
  yum: name=* state=latest
  notify:
      - reboot
      - Wait for host to stop
      - Wait for host to come back
      - Reload facts

- meta: flush_handlers

